version: '3.8'

services:
  preflight-mcp:
    build: .
    container_name: preflight-mcp
    restart: unless-stopped
    environment:
      - PREFLIGHT_STORAGE_DIRS=/app/bundles;/data/preflight-backup
      - PREFLIGHT_TMP_DIR=/tmp/preflight-mcp
      - PREFLIGHT_ANALYSIS_MODE=quick
      - PREFLIGHT_MAX_FILE_BYTES=1048576
      - PREFLIGHT_MAX_TOTAL_BYTES=104857600
      - GITHUB_TOKEN=${GITHUB_TOKEN}
      - CONTEXT7_API_KEY=${CONTEXT7_API_KEY}
    volumes:
      - preflight_bundles:/app/bundles
      - preflight_backup:/data/preflight-backup
      - preflight_tmp:/tmp/preflight-mcp
    networks:
      - preflight-network

  # 可选：Redis 用于缓存
  redis:
    image: redis:7-alpine
    container_name: preflight-redis
    restart: unless-stopped
    volumes:
      - redis_data:/data
    networks:
      - preflight-network

volumes:
  preflight_bundles:
  preflight_backup:
  preflight_tmp:
  redis_data:

networks:
  preflight-network:
    driver: bridge
